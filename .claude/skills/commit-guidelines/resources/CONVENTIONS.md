# コミット規則の詳細

このドキュメントでは、リポジトリで使用するConventional Commits準拠のコミットメッセージ規則を詳細に説明します。

## 基本構造

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

### 各要素の説明

#### 1. Type（必須）

変更の種類を示す英語のキーワード。以下のタイプを使用します：

| タイプ | 用途 | 例 |
|--------|------|-----|
| `feat` | 新機能の追加 | `feat: ユーザー認証機能を追加` |
| `fix` | バグ修正 | `fix: ログイン時のエラーを修正` |
| `docs` | ドキュメントのみの変更 | `docs: READMEに導入手順を追加` |
| `style` | フォーマット、セミコロンなど（コードの動作に影響しない変更） | `style: インデントを統一` |
| `refactor` | リファクタリング（機能追加やバグ修正を含まない） | `refactor: 認証ロジックを整理` |
| `perf` | パフォーマンス改善 | `perf: データベースクエリを最適化` |
| `test` | テストの追加・修正 | `test: ユーザーサービスのテストを追加` |
| `build` | ビルドシステムや外部依存関係の変更 | `build: webpackの設定を更新` |
| `ci` | CI設定ファイルやスクリプトの変更 | `ci: GitHub Actionsワークフローを追加` |
| `chore` | その他の変更（ビルドプロセス、補助ツールなど） | `chore: 依存パッケージを更新` |
| `revert` | 以前のコミットを取り消す | `revert: "feat: ユーザー認証機能を追加"を取り消す` |

#### 2. Scope（任意）

変更が影響する範囲を示します。プロジェクトの構造に応じて定義します。

**このリポジトリでの推奨スコープ：**
- `docs` - ドキュメント関連
- `skills` - Claudeスキル関連
- `config` - 設定ファイル関連
- `templates` - テンプレート関連

**例：**
```
feat(skills): commit-guidelinesスキルを追加
docs(templates): design.md.sampleを更新
```

#### 3. Description（必須）

変更内容を簡潔に説明する日本語の文章。

**ルール：**
- 日本語で記述
- 「〜を追加」「〜を修正」などの動詞形式を使用
- 何をしたかを明確に記述
- 簡潔に（目安：50文字以内）
- 末尾に句点（。）は不要

**良い例：**
```
feat: ユーザー認証機能を追加
fix: ログイン画面のレイアウト崩れを修正
docs: インストール手順を追加
```

**悪い例：**
```
feat: 追加  // 何を追加したのか不明
fix: バグ修正  // どのバグを修正したのか不明
update: ファイルを更新しました。  // typeが不適切、句点不要
```

#### 4. Body（任意）

変更の詳細な説明や背景。必要に応じて複数行で記述できます。

**使用するタイミング：**
- 変更の動機や背景を説明する必要がある場合
- 複雑な変更で追加の説明が必要な場合
- 影響範囲や注意点を記載する必要がある場合

**例：**
```
feat: セマンティック検索機能を追加

ベクトルデータベースを使用した高度な検索機能を実装。
従来のキーワード検索と比較して検索精度が向上。

影響範囲:
- 検索API: /api/search エンドポイントを追加
- データベース: vector_embeddingsテーブルを追加
```

#### 5. Footer（任意）

Breaking Changes、Issue参照、その他のメタデータを記載します。

**Breaking Changes:**
```
feat!: 認証APIを新バージョンに移行

BREAKING CHANGE: 旧APIエンドポイント /api/v1/auth は廃止されました。
/api/v2/auth を使用してください。
```

**Issue参照:**
```
fix: ログイン失敗時のエラーメッセージを改善

Closes #123
Refs #124
```

## 特殊なケース

### マージコミット

マージコミットは自動生成されるため、通常は編集不要ですが、必要に応じて以下の形式を使用：

```
Merge branch 'feature/user-auth' into main
```

### Revert

以前のコミットを取り消す場合：

```
revert: "feat: ユーザー認証機能を追加"

This reverts commit abc123def456.
```

### 複数の変更

1つのコミットに複数の変更を含める場合は、本文で箇条書きで説明：

```
feat: ユーザープロフィール機能を追加

以下の機能を実装:
- プロフィール編集画面
- アバター画像のアップロード
- プライバシー設定
```

## コミット粒度のガイドライン

### 適切なコミット粒度

- **1つの論理的な変更 = 1つのコミット**
- 各コミットは独立してビルド・テスト可能であること
- レビューしやすいサイズ（通常、数百行以内）

### 良い例

```
feat: ログイン画面のUIを実装
test: ログイン機能のテストを追加
docs: ログイン機能の使用方法を追加
```

### 悪い例

```
feat: ログイン機能、ユーザー管理、設定画面を追加
// 複数の独立した機能を1つのコミットに含めている
```

## ベストプラクティス

1. **atomic commits**: 各コミットは1つの目的を持つ
2. **意味のある粒度**: レビュー可能で理解しやすいサイズ
3. **明確な説明**: 何を・なぜ変更したかを明確に
4. **一貫性**: プロジェクト全体で規則を統一
5. **テスト可能**: 各コミットでコードがビルド・動作する状態に保つ

## チェックリスト

コミット前に以下を確認：

- [ ] 適切なtypeを使用しているか
- [ ] descriptionは日本語で簡潔に記述されているか
- [ ] 必要に応じてscopeを追加しているか
- [ ] Breaking Changesがある場合は明示しているか
- [ ] 関連するIssueがある場合は参照しているか
- [ ] 1つのコミットに複数の無関係な変更を含めていないか

## 参考資料

- [Conventional Commits 1.0.0](https://www.conventionalcommits.org/ja/v1.0.0/)
- [AngularJS Git Commit Guidelines](https://github.com/angular/angular/blob/main/CONTRIBUTING.md#commit)
- [Semantic Versioning 2.0.0](https://semver.org/lang/ja/)
