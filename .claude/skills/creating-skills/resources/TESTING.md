# スキルの評価とテスト戦略

スキル作成における評価とテストの詳細ガイドです。

## 基本原則

### "評価をコードより先に作成"

重要な原則: スキルの実装前に、成功基準を明確に定義します。

理由:
- 目標が明確になる
- 無駄な機能追加を避けられる
- テストケースが開発を導く（TDD的アプローチ）

手順:
1. スキルの目的を1文で記述
2. 成功シナリオを3つ以上列挙
3. 各シナリオの期待される出力を定義
4. スキル実装を開始

---

## テストケースの定義

### テストケースの形式

各スキルについて、最低3つのテストケースを作成します。

テンプレート:
```
テストケース: [名前]
入力: [ユーザーの指示内容]
期待される出力: [スキル実装後に得られるべき結果]
検証方法: [結果を確認する手段]
```

### 実例: markdown-style-rules スキル

#### テストケース1: 見出しのスタイル検証

```
テストケース: 見出し階層の検証
入力: "このMarkdownドキュメントが見出しガイドに従っているか確認してください"
期待される出力:
- 見出しレベルが正しい階層構造か（H1 → H2 → H3）
- H1は1つのみか
- H2以降の命名規則は正しいか（Sentence-style capitalization）
検証方法:
- チェックリストの生成と確認
- 問題点の指摘があれば修正提案が含まれているか
```

#### テストケース2: コードブロックの検証

```
テストケース: コードフォーマットの検証
入力: "コードブロックがスタイルガイドに従っているか確認してください"
期待される出力:
- 全コードブロックに言語指定があるか
- インラインコードにバッククォートが使用されているか
- プレースホルダーが山括弧 <> で囲まれているか
検証方法:
- スタイルガイドの各ルールに対するチェック結果
- 問題箇所の具体的な指摘（行番号付き）
```

#### テストケース3: リンク機能の検証

```
テストケース: 内部リンクの検証
入力: "ドキュメント内の目次リンクが正しく機能しているか確認してください"
期待される出力:
- 全アンカーリンクが有効か
- 見出しとアンカーが一致しているか
- 外部リンクのURL形式が正しいか
検証方法:
- リンククリックで正しいセクションに遷移するか
- 404エラーがないか
```

---

## 複数モデルでの検証

### なぜ複数モデルでテストするか

各Claudeモデルには異なる特性があります:

- Claude Haiku: 高速・軽量、基本的なタスク向け
- Claude Sonnet: バランス型、標準的なユースケース
- Claude Opus: 高性能、複雑なタスク向け

スキルは全モデルで機能する必要があるため、複数モデルでの検証が必須です。

### 検証手順

#### ステップ1: 各モデルでテストケースを実行

テストケース1（見出しスタイル検証）を例に:

```
モデル: Claude Haiku
入力: "このMarkdownドキュメントが見出しガイドに従っているか確認してください"
結果: [PASS / FAIL]
理由: [なぜPASSまたはFAILしたか]
改善点: [FAILの場合、どう改善すべきか]

モデル: Claude Sonnet
入力: [同上]
結果: [PASS / FAIL]
理由: [理由]
改善点: [改善点]

モデル: Claude Opus
入力: [同上]
結果: [PASS / FAIL]
理由: [理由]
改善点: [改善点]
```

#### ステップ2: 結果を記録

テーブル形式で記録すると比較が容易:

| テストケース | Haiku | Sonnet | Opus | 備考 |
|-------------|-------|--------|------|------|
| 見出し検証 | PASS | PASS | PASS | - |
| コード検証 | FAIL | PASS | PASS | Haiku: 詳細不足 |
| リンク検証 | PASS | PASS | PASS | - |

#### ステップ3: FAILの原因分析

FAIL理由の分類:

1. スキル内容の不明確さ
   - 対策: 説明を追加、例を豊富にする

2. モデルの性能限界
   - 対策: 該当モデル向けの簡易版を用意

3. トークン不足
   - 対策: Progressive Disclosureで分割

---

## 反復開発パターン

### 2つのClaudeインスタンスを活用

開発効率を最大化するため、2つのClaudeインスタンスを使用します。

#### Claude A（実装者）の役割

タスク:
- スキルの実装
- テストケースの定義
- 改善の実装

使用ツール:
- Write tool（SKILL.md作成）
- Edit tool（改善実装）
- Bash tool（ファイル確認）

#### Claude B（使用者）の役割

タスク:
- スキルの実際の使用
- フィードバック提供
- 改善点の指摘

使用方法:
```
/skill <skill-name>

[実際の使用シナリオを実行]

フィードバック:
- 良かった点: [具体的に]
- 改善すべき点: [具体的に]
- 期待と違った点: [具体的に]
```

### フィードバックループ

```
[イテレーション1]
Claude A: スキル初版を作成
↓
Claude B: 実際に使用してフィードバック
フィードバック例:
- "見出し検証の例がもっと欲しい"
- "アンチパターンが不明確"
↓
Claude A: フィードバックを基に改善
↓

[イテレーション2]
Claude B: 改善版を使用してフィードバック
フィードバック例:
- "例は十分になった"
- "ただし、トークン消費が多い"
↓
Claude A: Progressive Disclosureで分割
↓

[イテレーション3以降]
...最低2回以上のイテレーションを推奨
```

---

## 実践例: creating-skills スキルのテスト

### テストケース定義

#### テストケース1: 新規スキル作成支援

```
テストケース: 新規スキル作成の支援
入力: "コード命名規則についてのスキルを作成してください。creating-skillsスキルの手順に従ってください"
期待される出力:
- ディレクトリ作成
- SKILL.md作成
- Frontmatter設定
- 目次作成
- 本文作成
- 動作確認
検証方法:
- 作成されたスキルが正しい構造か
- Frontmatterが適切か
- 500行以内に収まっているか
```

#### テストケース2: 既存スキルの改善

```
テストケース: 既存スキルの改善提案
入力: "markdown-style-rulesスキルを公式ベストプラクティスに従って改善してください"
期待される出力:
- 不足している情報の指摘
- 改善提案
- 具体的な修正内容
検証方法:
- 公式ドキュメントとの一致度
- Progressive Disclosureの実装
- トークン効率化
```

#### テストケース3: トラブルシューティング支援

```
テストケース: スキル認識エラーの解決
入力: "スキルが認識されません。トラブルシューティングしてください"
期待される出力:
- 問題の特定（ディレクトリ構造、ファイル名、frontmatterなど）
- 具体的な修正手順
- 動作確認方法
検証方法:
- 問題が解決されるか
- 説明が明確か
```

### モデル別検証結果

| テストケース | Haiku | Sonnet | Opus |
|-------------|-------|--------|------|
| 新規作成支援 | PASS | PASS | PASS |
| 既存改善 | PASS | PASS | PASS |
| トラブル解決 | PASS | PASS | PASS |

備考:
- 全モデルでPASS
- ただし、Opusが最も詳細な説明を提供
- Haikuは簡潔だが十分な情報

---

## ベストプラクティス

### 1. テストケースは具体的に

悪い例:
```
テストケース: スキルが動作する
入力: スキルを使う
期待される出力: 正しく動作する
```

良い例:
```
テストケース: 見出し階層の検証
入力: "このMarkdownドキュメントが見出しガイドに従っているか確認してください"
期待される出力:
- 見出しレベルのチェック結果
- 問題箇所の具体的な指摘
- 修正提案
検証方法: チェックリストの内容確認
```

### 2. エッジケースをテスト

通常ケースだけでなく、エッジケースもテスト:

- 空のドキュメント
- 非常に長いドキュメント（1000行以上）
- 特殊文字を含むドキュメント
- 不正な形式のドキュメント

### 3. パフォーマンスを測定

テスト時に測定すべき項目:

- 応答時間（秒）
- トークン消費量
- メモリ使用量（大規模スキルの場合）

目標:
- 応答時間: 5秒以内
- トークン消費: 合理的な範囲（目安: 500トークン以下）

### 4. ドキュメント化

テスト結果を記録:

```markdown
## テスト結果

日付: 2025-11-14
バージョン: 1.0.0

| テストケース | Haiku | Sonnet | Opus | 備考 |
|-------------|-------|--------|------|------|
| ... | ... | ... | ... | ... |

改善点:
- [具体的な改善点]

次のアクション:
- [次に実施すべきこと]
```

---

## まとめ

スキル評価とテストのキーポイント:

1. 評価をコードより先に作成
2. 最低3つのテストケースを定義
3. 複数モデル（Haiku, Sonnet, Opus）で検証
4. 2つのClaudeインスタンスで反復開発
5. 結果を記録し、継続的に改善

これらの手法により、高品質で信頼性の高いスキルを作成できます。

---

バージョン: 1.0.0
最終更新: 2025-11-14
